<!-- Using SST to upload Next.js to AWS S3 and CloudFront -->

To learn AWS, I initially wanted to just make a static site with vanilla HTML and CSS, but because I think Next.js will be ubiquitous in the future, I wanted to get ahead by learning how to deploy based on my own infrastructure. Doing so will be a great cost-saving tool in the future as I no longer have to rely on Vercel to host my sites. Besides, Vercel uses AWS under the hood anyway so removing that abstraction ultimately leads to the same result. Although, I'm hoping site speed and performance improves when self-deploying.

Going through the SST docs was overall a straightforward experience. There was a lot of setup required on the AWS end to replicate a real-world workflow such as creating my IAM management account and then using AWS organizations to extend my permissions into -dev and -production accounts. This was followed by setting up email aliases for aforementioned three IAMs and have them route to my main email. Perhaps this is not necessary when working alone, but definitely valuable in a team environment. CloudFlare has a great email forwarding service.

Setting up the AWS CLI was also relatively easy too. After setting up the IAMs, I needed to head over to ~/.aws to setup my configurations and credentials. I couldn't get paste to work in nano so I had to hand-type all of the keys which was quite tedious but not too bad. Since I used WSL, I had to create a script aws-login.sh to let me open a window in my host browser.

SST has been great thus far. It knows to upload static assets to S3 and then serve with CLoudFront while deploying SSR + API routes to AWS Lambda functions behind an API Gateway. This ensures dynamic requests are processed in real time.

Setup a custom domain awsjameslo.com by first purchasing a domain name on PorkBun which offers the lowest prices as of present (12/06/2024). I then created a hosted zone with AWS Route 53 and requested a public SSL using AWS Certificate Manager. Route 53 is a pretty cost effective way to handle DNS routing at only 0.50 cents per month. However, there are free alternatives like Cloudflare. I created Route 53 records using my new SSL and then added custom CName and SSL to CloudFront. Finally, I directed traffic to CloudFront by creating an A record with an alias. Implementation was fine but I noticed an error "ERR_SSL_VERSION_OR_CIPHER_MISMATCH" when accessing custom domain from desktop. I tested the SSL using SSL Labs and accessed on mobile iOS + MacBook. Both worked without issue. I deleted cookies and cache but that did not help. Issue eventually resolved itself, which most likely is related to DNS propagation.

Used TypeScript to implement a Counter component that will make an API call to get the total visitor count number and display it on the frontend.

To prevent DNS spoofing ("main-in-the-middle") attacks, I configured DNSSEC on Route 53 by creating a key-signing key (KSK) using AWS KMS and using the key to establish a chain of trust with my domain registrar PorkBun. I am still figuring out automation of key rotation, but for now I will use the double-RR method to rotate my keys every 90 days.
